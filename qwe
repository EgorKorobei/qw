import telebot
from telebot import types
import openpyxl as op
import os
from time import sleep


bot = telebot.TeleBot('token')

@bot.message_handler(commands=['start'])
def auth(message):
    id = open('C:/Users/79128/classes/id.txt', 'r')
    if str(message.from_user.id) not in str(id.read()):
        id.close()
        id = open('C:/Users/79128/classes/id.txt', 'a')
        id.write(f'{message.from_user.id} \n')
        id.close()

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)

    btn5a = types.KeyboardButton('5 –ê')
    btn5b = types.KeyboardButton('5 –ë')
    btn5c = types.KeyboardButton('5 –í')

    btn6a = types.KeyboardButton('6 –ê')
    btn6b = types.KeyboardButton('6 –ë')
    btn6c = types.KeyboardButton('6 –í')

    btn7a = types.KeyboardButton('7 –ê')
    btn7b = types.KeyboardButton('7 –ë')
    btn7c = types.KeyboardButton('7 –í')

    btn8a = types.KeyboardButton('8 –ê')
    btn8b = types.KeyboardButton('8 –ë')
    btn8c = types.KeyboardButton('8 –í')

    btn9a = types.KeyboardButton('9 –ê')
    btn9b = types.KeyboardButton('9 –ë')
    btn9c = types.KeyboardButton('9 –í')

    btn10a = types.KeyboardButton('10 –ê')
    btn10b = types.KeyboardButton('10 –ë')
    btn10c = types.KeyboardButton('10 –í')

    btn11a = types.KeyboardButton('11 –ê')
    btn11b = types.KeyboardButton('11 –ë')
    btn11c = types.KeyboardButton('11 –í')

    markup.row(btn5a, btn5b, btn5c)
    markup.row(btn6a, btn6b, btn6c)
    markup.row(btn7a, btn7b, btn7c)
    markup.row(btn8a, btn8b, btn8c)
    markup.row(btn9a, btn9b, btn9c)
    markup.row(btn10a, btn10b, btn10c)
    markup.row(btn11a, btn11b, btn11c)

    bot.send_message(message.chat.id, '–ü—Ä–∏–≤–µ—Ç!')
    msg = bot.send_message(message.chat.id, '–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –∫–ª–∞—Å—Å', reply_markup=markup)

    bot.register_next_step_handler(msg, auth2)

def auth2(message):
    global class_
    global parall

    classes = '5 –∞, 5 –±, 5 –≤, 6 –∞, 6 –±, 6 –≤, 7 –∞, 7 –±, 7 –≤, 8 –∞, 8 –±, 8 –≤, 9 –∞, 9 –±, 9 –≤, 10 –∞, 10 –±, 10 –≤, 11 –∞, 11 –±, 11 –≤'

    if str(message.text.lower()) not in str(classes):
        bot.send_message(message.chat.id, '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª–∞—Å—Å. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑')
        return
    msg = bot.send_message(message.chat.id, '–ê —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ —Å–≤–æ–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é')
    bot.register_next_step_handler(msg, auth3)
    parall, class_ = map(str,message.text.lower().split())


def auth3(message):
    global name
    name = message.text

    if os.path.exists(f'C://Users/79128/classes/{parall}'):
        if os.path.exists(f'C://Users/79128/classes/{parall}/{class_}'):
            if not os.path.exists(f'C://Users/79128/classes/{parall}/{class_}/{str(name.lower())} ({message.from_user.id})'):
                os.mkdir(f'C://Users/79128/classes/{parall}/{class_}/{str(name.lower())} ({message.from_user.id})')
        else:
            os.mkdir(f'C://Users/79128/classes/{parall}/{class_}')
    else:
        os.mkdir(f'C://Users/79128/classes/{parall}')


    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)

    btn_profile = types.KeyboardButton('üë§ –ü—Ä–æ—Ñ–∏–ª—å')
    btn_help = types.KeyboardButton('‚ùì –ü–æ–º–æ—â—å')
    btn_navigation = types.KeyboardButton('üåç –ù–∞–≤–∏–≥–∞—Ü–∏—è')

    markup.row(btn_profile)
    markup.row(btn_help,btn_navigation)
    bot.send_message(message.chat.id, f'–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!\n–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏, –∫–∞–∫ {name}', reply_markup=markup)

@bot.message_handler(content_types=['text'])
def hotbar(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn_home = types.KeyboardButton('*—Ç—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à —ç–º–æ–¥–∑–∏* –í –º–µ–Ω—é')
    markup.row(btn_home)

    if message.text == 'üë§ –ü—Ä–æ—Ñ–∏–ª—å':
        msg = bot.send_message(message.chat.id, f'–ò–º—è: {name}\n–ö–ª–∞—Å—Å: {parall}{class_.upper()}', reply_markup=markup)
        bot.register_next_step_handler(msg, btn_menu_)
    elif message.text == '‚ùì –ü–æ–º–æ—â—å':
        msg = bot.send_message(message.chat.id, f'–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', reply_markup=markup)
        bot.register_next_step_handler(msg, btn_menu_)
    elif message.text == 'üåç –ù–∞–≤–∏–≥–∞—Ü–∏—è':
        msg = bot.send_message(message.chat.id, f'–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', reply_markup=markup)
        bot.register_next_step_handler(msg, btn_menu_)

def btn_menu_(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn_profile = types.KeyboardButton('üë§ –ü—Ä–æ—Ñ–∏–ª—å')
    btn_help = types.KeyboardButton('‚ùì –ü–æ–º–æ—â—å')
    btn_navigation = types.KeyboardButton('üåç –ù–∞–≤–∏–≥–∞—Ü–∏—è')
    markup.row(btn_profile)
    markup.row(btn_help, btn_navigation)

    if message.text == '*—Ç—É—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à —ç–º–æ–¥–∑–∏* –í –º–µ–Ω—é':
        bot.send_message(message.chat.id, '–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –º–µ–Ω—é', reply_markup=markup)


bot.polling(none_stop=True, interval=0)
